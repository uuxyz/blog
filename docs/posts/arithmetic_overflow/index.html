<!DOCTYPE html>
<html lang='en-us'>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>arithmetic overflow</title>
    
    
    <style type="text/css" media="all">@import "/css/style.css";</style>
    <style type="text/css" media="all">@import "/css/syntax.css";</style>
    
  </head>
  <body>
    <header>
  <span class="site-title"
    style="font-size:3rem;display:inline-block;vertical-align:middle;"><a
      href="https://upunder.us"><img src="/icon/favicon.svg" alt="img" width="64rem"
        height="64rem"
        style="display:inline-block;vertical-align: middle;" /></a> up under us</span>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  
</header>

    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body, {delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '$', right: '$', display: false },
          { left: '\\(', right: '\\)', display: true },
          { left: '\\[', right: '\\]', display: true },
      ]});"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body);
    });
</script>


<main>
  <article>
    <header>
      <h1>arithmetic overflow</h1>
    </header>
    <time datetime='2023-12-12T00:00:00'>
      2023.12.12 00:00
    </time>
    
    Reading time:
    
    
    
    
    1 min
    
    4 s.
    <div>
      <h3>Table of contents</h3>
      <nav id="TableOfContents"></nav>
    </div>
    <p>Using those code to avoid overflow:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int64_t</span> mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7fffffffffffffe7LL</span>; <span style="color:#75715e">// 216289611853439384th prime
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int64_t</span> a01 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7fffffffffffff5bLL</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int64_t</span> b01 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7ffffffffffffefdLL</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int64_t</span> <span style="color:#a6e22e">add64</span>(<span style="color:#66d9ef">int64_t</span> a, <span style="color:#66d9ef">int64_t</span> b, <span style="color:#66d9ef">int64_t</span> m) {
</span></span><span style="display:flex;"><span>  a <span style="color:#f92672">%=</span> m;
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">%=</span> m;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (m <span style="color:#f92672">-</span> a <span style="color:#f92672">&lt;</span> b)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">&gt;</span> b <span style="color:#f92672">?</span> a <span style="color:#f92672">-</span> m <span style="color:#f92672">+</span> b : b <span style="color:#f92672">-</span> m <span style="color:#f92672">+</span> a;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int64_t</span> <span style="color:#a6e22e">sub64</span>(<span style="color:#66d9ef">int64_t</span> a, <span style="color:#66d9ef">int64_t</span> b, <span style="color:#66d9ef">int64_t</span> m) {
</span></span><span style="display:flex;"><span>  a <span style="color:#f92672">%=</span> m;
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">%=</span> m;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> a <span style="color:#f92672">-</span> b <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> a <span style="color:#f92672">-</span> b <span style="color:#f92672">+</span> m : a <span style="color:#f92672">-</span> b;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int64_t</span> <span style="color:#a6e22e">mul64</span>(<span style="color:#66d9ef">int64_t</span> a, <span style="color:#66d9ef">int64_t</span> b, <span style="color:#66d9ef">int64_t</span> m) {
</span></span><span style="display:flex;"><span>  a <span style="color:#f92672">%=</span> m, b <span style="color:#f92672">%=</span> m;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int64_t</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (; b; b <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (b <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>      res <span style="color:#f92672">=</span> <span style="color:#a6e22e">add64</span>(res, a, m);
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> <span style="color:#a6e22e">add64</span>(a, a, m);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int64_t</span> <span style="color:#a6e22e">binpow</span>(<span style="color:#66d9ef">int64_t</span> a, <span style="color:#66d9ef">int64_t</span> b, <span style="color:#66d9ef">int64_t</span> m) {
</span></span><span style="display:flex;"><span>  a <span style="color:#f92672">%=</span> m;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int64_t</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (; b; b <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (b <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>      res <span style="color:#f92672">=</span> <span style="color:#a6e22e">mul64</span>(res, a, m);
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> <span style="color:#a6e22e">mul64</span>(a, a, m);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> res <span style="color:#f92672">%</span> m;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int64_t</span> <span style="color:#a6e22e">div64</span>(<span style="color:#66d9ef">int64_t</span> a, <span style="color:#66d9ef">int64_t</span> b, <span style="color:#66d9ef">int64_t</span> m) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mul64</span>(a, <span style="color:#a6e22e">binpow</span>(b, m <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>, m), m);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> a, b, m;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scanf</span>(<span style="color:#e6db74">&#34;%lld%lld%lld&#34;</span>, <span style="color:#f92672">&amp;</span>a, <span style="color:#f92672">&amp;</span>b, <span style="color:#f92672">&amp;</span>m);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%lld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">add64</span>(a, b, mod));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%lld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">sub64</span>(a, b, mod));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%lld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">mul64</span>(a, b, mod));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%lld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">div64</span>(a, b, mod));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%lld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">binpow</span>(a, b, mod));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    
  </article>
</main>

<a href="https://upunder.us/posts/linear_algebra/">Prev: linear algebra</a>

<br>

<a href="https://upunder.us/posts/cstring/">Next: cstring</a>

<aside class="latest-posts">
  <div>
    <div class="section-header">
      <h3>LATEST POSTS</h3>
    </div>
    <div class="post-list">
      <ul>
        
        <li><a href="/posts/english_grammar/">english grammar</a></li>
        
        <li><a href="/posts/number_theory/">number theory</a></li>
        
        <li><a href="/posts/mnemonic/">mnemonic</a></li>
        
        <li><a href="/posts/cstring/">cstring</a></li>
        
        <li><a href="/posts/arithmetic_overflow/">arithmetic overflow</a></li>
        
      </ul>
    </div>
  </div>
</aside>


    <footer class="site-footer">
  <p>2024 <a href="https://upunder.us">up under us</a></p>
</footer>

  </body>
</html>
